# Day 28 - 2025/11/13

## 学んだこと

### 1. LocalStorageのエラーハンドリング
- LocalStorageからのデータ読み込み時のエラーハンドリングの重要性
- try-catch文を使った安全なデータ取得方法
- JSON.parse()が失敗する可能性への対処

### 2. 防御的プログラミング
- データの読み込みが失敗した場合のフォールバック処理
- エラー発生時にも正常に動作するような設計
- console.errorを使ったエラーログの出力

## 実装した内容
- Budget AppのLocalStorage読み込み処理にtry-catchを追加
- エラー発生時は空配列を返すフォールバック処理を実装
- エラーメッセージをコンソールに出力する機能を追加

## 学習メモ

### LocalStorageのエラーハンドリングの必要性

LocalStorageからデータを読み込む際、以下のような理由でエラーが発生する可能性があります：

1. **JSON.parse()の失敗**
   - 保存されたデータが壊れている場合
   - 不正なJSON形式のデータが保存されている場合

2. **ブラウザの制限**
   - プライベートモードでLocalStorageが無効になっている場合
   - ストレージ容量が上限に達している場合

### 実装したエラーハンドリングのパターン

```jsx
const [transactions, setTransactions] = useState(() => {
  try {
    const savedTransactions = localStorage.getItem('transactions')
    return savedTransactions ? JSON.parse(savedTransactions) : []
  } catch (error) {
    console.error('LocalStorageからのデータ読み込みに失敗しました:', error)
    return []
  }
})
```

**ポイント：**
- `try-catch`で読み込み処理全体を囲む
- エラー発生時は空配列`[]`を返して、アプリが正常に起動できるようにする
- `console.error()`でエラー内容をログに出力し、デバッグを容易にする

### 防御的プログラミングの考え方

この実装は「防御的プログラミング」の一例です：

- **最悪のケースを想定する**: データが壊れていても動作する
- **フェイルセーフ**: エラーが発生しても、アプリ全体がクラッシュしない
- **デバッグ情報の提供**: console.errorで問題を追跡できるようにする

### なぜuseState初期化時にエラーハンドリングが必要か

前日（Day 27）に実装したLocalStorage読み込みは、useState初期化のタイミングで実行されます：

```jsx
// 初期化時に即座に実行される
const [transactions, setTransactions] = useState(() => {
  const savedTransactions = localStorage.getItem('transactions')
  return savedTransactions ? JSON.parse(savedTransactions) : []
})
```

このタイミングでエラーが発生すると：
- コンポーネントの初期化が失敗する
- アプリ全体が起動しなくなる可能性がある

そのため、try-catchでエラーをキャッチし、安全なデフォルト値（空配列）を返すことが重要です。

## 次のステップ

- [ ] LocalStorage保存時のエラーハンドリングも追加する（useEffect内）
- [ ] ストレージ容量の上限チェック機能を検討
- [ ] エラー発生時のユーザーへの通知方法を考える
- [ ] リポジトリ構成の整理（frontend/ディレクトリへの移行準備）
