# Day 22 - 2025/11/07

## 学んだこと

### 1. LocalStorageを活用した状態の永続化
- useStateの初期値に関数を渡す方法（遅延初期化）
- LocalStorageからのデータ読み込みと復元
- useEffectでの自動保存の実装
- JSON.stringify / JSON.parseでのデータ変換

### 2. 配列操作による状態管理
- mapメソッドを使った配列要素の部分更新
- スプレッド構文でのオブジェクトプロパティ更新
- filterメソッドを使った要素の削除
- idベースでの要素特定と操作

### 3. CSSスタイリング技術
- Flexboxによるレイアウト構築
- 疑似クラス（:first-child, :last-child）の活用
- transitionによるスムーズなアニメーション効果
- レスポンシブデザインの実装

## 実装した内容
- お気に入りリストアプリ（favorites-app）の完成
- アイテムの追加・削除機能
- お気に入りマーク（星アイコン★/☆）のトグル機能
- LocalStorageによるデータ永続化
- レスポンシブなUIデザイン
- スムーズなホバーエフェクト

## 学習メモ

### useStateの初期値に関数を使用する理由

通常、useStateの初期値は直接値を渡しますが、LocalStorageから読み込む場合は関数を渡すのがベストプラクティスです：

```jsx
// ❌ 毎回実行される（無駄）
const [items, setItems] = useState(
  JSON.parse(localStorage.getItem('favorites')) || []
);

// ✅ 初回のみ実行される（効率的）
const [items, setItems] = useState(() => {
  const saved = localStorage.getItem('favorites');
  return saved ? JSON.parse(saved) : [];
});
```

**理由**: 関数を渡すと、コンポーネントの初回レンダリング時のみ実行されます。直接値を渡すと、再レンダリングのたびにLocalStorageへのアクセスが発生し、パフォーマンスが低下します。

### useEffectでの自動保存

データが変更されるたびに自動的にLocalStorageに保存する仕組み：

```jsx
useEffect(() => {
  localStorage.setItem('favorites', JSON.stringify(items));
}, [items]); // itemsが変更されたら実行
```

**依存配列`[items]`の重要性**: itemsが変更されたときだけ保存処理が実行されるため、無駄な保存を防ぎます。

### mapメソッドでの部分更新

配列内の特定要素だけを更新する方法：

```jsx
const toggleFavorite = (id) => {
  setItems(items.map(item =>
    item.id === id
      ? { ...item, isFavorite: !item.isFavorite }  // 該当要素のみ更新
      : item                                        // それ以外はそのまま
  ));
};
```

**ポイント**:
- `item.id === id`で更新対象を判定
- スプレッド構文`{ ...item, ... }`で既存のプロパティを保持しつつ、特定プロパティのみ更新
- 元の配列は変更せず、新しい配列を返す（イミュータブルな更新）

### filterメソッドでの削除

指定したID以外の要素を残すことで削除を実現：

```jsx
const deleteItem = (id) => {
  setItems(items.filter(item => item.id !== id));
};
```

**削除の仕組み**: `item.id !== id`の条件でfilterすることで、指定したid以外の要素だけが新しい配列に含まれます。結果的に指定したidの要素が「削除」されます。

### コード例（完全版）

```jsx
import { useState, useEffect } from 'react';
import './App.css';

function App() {
  // LocalStorageから初期データを読み込む（初回のみ実行）
  const [items, setItems] = useState(() => {
    const saved = localStorage.getItem('favorites');
    return saved ? JSON.parse(saved) : [];
  });

  const [inputValue, setInputValue] = useState('');

  // itemsが変更されたら自動保存
  useEffect(() => {
    localStorage.setItem('favorites', JSON.stringify(items));
  }, [items]);

  // アイテム追加
  const addItem = (e) => {
    e.preventDefault();
    if (!inputValue.trim()) return;

    const newItem = {
      id: Date.now(),
      text: inputValue,
      isFavorite: false
    };

    setItems([...items, newItem]);
    setInputValue('');
  };

  // お気に入りトグル
  const toggleFavorite = (id) => {
    setItems(items.map(item =>
      item.id === id
        ? { ...item, isFavorite: !item.isFavorite }
        : item
    ));
  };

  // アイテム削除
  const deleteItem = (id) => {
    setItems(items.filter(item => item.id !== id));
  };

  return (
    <div className="app">
      <h1>お気に入りリスト</h1>

      <form onSubmit={addItem}>
        <input
          type="text"
          value={inputValue}
          onChange={(e) => setInputValue(e.target.value)}
          placeholder="アイテムを追加"
        />
        <button type="submit">追加</button>
      </form>

      <ul>
        {items.map(item => (
          <li key={item.id}>
            <span
              className="favorite-icon"
              onClick={() => toggleFavorite(item.id)}
            >
              {item.isFavorite ? '★' : '☆'}
            </span>
            <span className="item-text">{item.text}</span>
            <button onClick={() => deleteItem(item.id)}>削除</button>
          </li>
        ))}
      </ul>
    </div>
  );
}

export default App;
```

### CSSのポイント

```css
/* ホバー時のスムーズな変化 */
button {
  transition: background-color 0.3s ease;
}

button:hover {
  background-color: #0056b3;
}

/* 疑似クラスでのスタイル調整 */
li:first-child {
  border-top: 1px solid #ddd;
}

li:last-child {
  border-bottom: 1px solid #ddd;
}

/* Flexboxでのレイアウト */
li {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px;
}
```

### これまでの学習の統合

今回のアプリでは、これまで学んだ知識を総合的に活用しました：

1. **ToDoアプリ（Day 1-2）から**: LocalStorageを使ったデータ永続化
2. **計算機アプリ（Day 20-21）から**: 配列操作（map, filter）
3. **全アプリ共通**: useState、useEffect、イベント処理

### データ構造の設計

```javascript
// 各アイテムのデータ構造
{
  id: 1699123456789,        // ユニークID（タイムスタンプ）
  text: "学習資料",          // アイテムの内容
  isFavorite: true          // お気に入りフラグ
}
```

**id生成に`Date.now()`を使う理由**: タイムスタンプはミリ秒単位で生成されるため、通常の操作では重複しない一意のIDを簡単に生成できます。

### LocalStorageの注意点

- **容量制限**: 約5-10MB（ブラウザによって異なる）
- **データ形式**: 文字列のみ保存可能（オブジェクトはJSON.stringifyで変換）
- **セキュリティ**: 機密情報は保存しない（JavaScriptから簡単にアクセス可能）
- **同期処理**: LocalStorageへのアクセスは同期的なので、大量データの場合は注意

## 次のステップ

- [ ] お気に入りでフィルタリング機能を追加（お気に入りのみ表示）
- [ ] アイテムの編集機能を実装
- [ ] カテゴリー分け機能の追加
- [ ] 検索機能の実装
- [ ] ドラッグ&ドロップでの並び替え機能
- [ ] 次の新しいアプリ開発の計画を立てる
