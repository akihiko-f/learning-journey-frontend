# Day 26 - 2025/11/11

## 学んだこと

### 1. 取引履歴のフィルタリング機能
- `type="month"`を使った年月選択入力の実装方法
- `startsWith()`メソッドを使った日付文字列のフィルタリング
- 三項演算子を使った条件付きフィルタリング
- フィルタリング結果を複数の計算に再利用する方法

### 2. データフローの設計
- フィルタリングロジックを一箇所にまとめる利点
- `filteredTransactions`を中間変数として定義し、表示と計算の両方で使う設計パターン
- 元のデータ（`transactions`）を変更せずに表示用のデータを作成する考え方

### 3. 条件付きレンダリング
- `{selectedMonth && <button>...</button>}`を使った要素の表示/非表示
- 選択された月がある場合のみ「全期間を表示」ボタンを表示する実装

## 実装した内容
- 月選択セレクター（`type="month"`の入力フィールド）を追加
- 選択された月に基づいて取引履歴をフィルタリング
- フィルタリングされた取引のみを表示
- フィルタリングに応じた収入・支出・残高の再計算
- 「全期間を表示」ボタンの実装（選択月をリセット）

## 学習メモ

### 月フィルタリングの仕組み

```jsx
const [selectedMonth, setSelectedMonth] = useState('')

const filteredTransactions = selectedMonth
  ? transactions.filter(t => t.date.startsWith(selectedMonth))
  : transactions
```

この実装のポイント：
1. `selectedMonth`が空文字列の場合は全取引を表示
2. `selectedMonth`に値がある場合（例: "2025-11"）は、その月の取引のみをフィルタリング
3. `startsWith()`は日付文字列（"2025-11-15"）が指定された月（"2025-11"）で始まるかをチェック

### type="month"の動作

```jsx
<input
  type="month"
  value={selectedMonth}
  onChange={(e) => setSelectedMonth(e.target.value)}
/>
```

- `type="month"`は年月を選択できる特別な入力タイプ
- 値の形式は`"YYYY-MM"`（例: "2025-11"）
- この形式が`type="date"`の値（"YYYY-MM-DD"）の接頭辞になっているため、`startsWith()`でマッチできる

### データフローの全体像

```
1. 全取引データ (transactions)
     ↓
2. フィルタリング (filteredTransactions)
     ↓ ↓ ↓
3. 分岐: 表示用 / 収入計算 / 支出計算
```

```jsx
// 1つのフィルタリング結果を3箇所で使用
const filteredTransactions = selectedMonth
  ? transactions.filter(t => t.date.startsWith(selectedMonth))
  : transactions

// 使用箇所1: 収入の合計計算
const totalIncome = filteredTransactions
  .filter(t => t.type === 'income')
  .reduce((sum, t) => sum + t.amount, 0)

// 使用箇所2: 支出の合計計算
const totalExpense = filteredTransactions
  .filter(t => t.type === 'expense')
  .reduce((sum, t) => sum + t.amount, 0)

// 使用箇所3: 取引履歴の表示
filteredTransactions.map(transaction => (
  <div key={transaction.id}>...</div>
))
```

この設計の利点：
- フィルタリングロジックが一箇所にまとまっている
- 同じフィルタリング結果を複数の場所で一貫して使用できる
- 修正が必要な場合も一箇所を変更するだけで済む

### 条件付きボタンの表示

```jsx
{selectedMonth && (
  <button onClick={() => setSelectedMonth('')}>
    全期間を表示
  </button>
)}
```

- `&&`の左側が`true`（truthy）の場合のみ右側の要素を表示
- `selectedMonth`が空文字列の場合は`false`（falsy）なのでボタンは表示されない
- 月が選択されている場合のみリセットボタンを表示するUI設計

### startsWith()メソッドの活用

```jsx
transactions.filter(t => t.date.startsWith(selectedMonth))
```

なぜ`startsWith()`を使うのか：
- 日付の形式: `"2025-11-15"`（YYYY-MM-DD）
- 選択月の形式: `"2025-11"`（YYYY-MM）
- `"2025-11-15".startsWith("2025-11")` → `true`
- `"2025-10-20".startsWith("2025-11")` → `false`

文字列の前方一致を簡単にチェックできるため、日付フィルタリングに最適。

### 今日学んだReactパターン

1. **中間変数の活用**: 計算結果を変数に保存して複数箇所で使う
2. **条件付きフィルタリング**: 三項演算子で条件に応じたデータを返す
3. **文字列メソッドの活用**: `startsWith()`で日付の部分一致を実現
4. **条件付きレンダリング**: `&&`演算子で要素の表示を制御

## 次のステップ

- [ ] LocalStorageを使った取引データの永続化
- [ ] CSSスタイリングによるUI改善
- [ ] カテゴリ別の支出分析機能
- [ ] グラフ表示機能の追加
